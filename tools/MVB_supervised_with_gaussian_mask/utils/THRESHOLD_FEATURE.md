# 高斯掩码回归阈值控制功能

## 概述
新增了阈值控制功能到高斯掩码回归损失函数中。现在只有大于指定阈值的像素点才会参与损失计算和模型参数更新。

## 功能特点
- **阈值过滤**: 只有高斯掩码值大于等于阈值的像素点参与损失计算
- **配置灵活**: 通过配置文件简单设置阈值参数
- **聚焦核心**: 重点关注高置信度区域（高斯分布的中心区域）
- **减少噪音**: 忽略边缘和低置信度区域，减少噪音对训练的影响

## 配置方法
在 `mvb_config.yaml` 中添加以下参数：

```yaml
TRAIN:
  LOSS:
    mask_threshold: 0.1  # 阈值设置，范围 [0.0, 1.0]
```

### 阈值效果分析
- **threshold = 0.0**: 所有像素参与损失计算（默认行为）
- **threshold = 0.1**: 约 14.2% 的像素参与损失计算
- **threshold = 0.3**: 约 7.5% 的像素参与损失计算  
- **threshold = 0.5**: 约 4.3% 的像素参与损失计算
- **threshold = 0.7**: 约 2.2% 的像素参与损失计算

## 实现原理
1. 根据边界框生成高斯掩码作为目标
2. 创建阈值掩码，标记哪些像素值大于阈值
3. 计算逐像素损失（MSE/L1/SmoothL1）
4. 使用阈值掩码过滤损失，只保留有效像素的损失
5. 对有效像素的损失求平均值

## 测试验证
运行测试脚本验证功能：
```bash
python tools/MVB_supervised_with_gaussian_mask/test_threshold_mask.py
```

该脚本会：
- 测试不同阈值设置下的损失值
- 可视化阈值效果
- 比较不同阈值对损失计算的影响

## 使用建议
- **起始训练**: 使用较低阈值（0.1-0.2）包含更多上下文信息
- **精细训练**: 使用较高阈值（0.3-0.5）聚焦核心区域
- **数据集适应**: 根据数据质量调整，噪音多时用高阈值
- **实验对比**: 尝试不同阈值找到最佳设置

## 文件修改
1. `openunreid/models/losses/mask_regression.py`: 添加阈值控制逻辑
2. `openunreid/models/losses/__init__.py`: 更新损失函数构建器
3. `mvb_config.yaml`: 添加阈值配置参数
4. `test_threshold_mask.py`: 测试脚本验证功能

## 兼容性
- 向后兼容：未设置阈值时（threshold=0.0）保持原有行为
- 所有现有损失类型（MSE, L1, SmoothL1）均支持阈值控制
- 不影响其他损失函数的正常工作