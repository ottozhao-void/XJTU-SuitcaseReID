<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1000" height="800" xmlns="http://www.w3.org/2000/svg">
    <!-- Background -->
    <rect width="1000" height="800" fill="#ffffff"/>
    <text x="500" y="40" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">SuitcaseReID: Model Architecture and Training Pipeline</text>

    <!-- ResNet50 Backbone -->
    <rect x="50" y="70" width="900" height="300" fill="#f0f9eb" stroke="#52c41a" stroke-width="2" rx="5"/>
    <text x="500" y="95" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold" fill="#52c41a">Feature Extraction: ResNet50 Backbone</text>

    <!-- Stage 1 -->
    <rect x="70" y="120" width="160" height="100" fill="#fff" stroke="#52c41a" stroke-width="1" rx="3"/>
    <text x="150" y="140" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Conv1 Stage</text>
    <text x="150" y="160" font-family="Arial" font-size="12" text-anchor="middle">7×7 conv, 64, /2</text>
    <text x="150" y="175" font-family="Arial" font-size="12" text-anchor="middle">BatchNorm2d</text>
    <text x="150" y="190" font-family="Arial" font-size="12" text-anchor="middle">ReLU</text>
    <text x="150" y="205" font-family="Arial" font-size="12" text-anchor="middle">3×3 MaxPool, /2</text>

    <!-- Stage 2 -->
    <rect x="250" y="120" width="160" height="100" fill="#fff" stroke="#52c41a" stroke-width="1" rx="3"/>
    <text x="330" y="140" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Stage 2 (×3)</text>
    <text x="330" y="160" font-family="Arial" font-size="12" text-anchor="middle">1×1, 64</text>
    <text x="330" y="175" font-family="Arial" font-size="12" text-anchor="middle">3×3, 64</text>
    <text x="330" y="190" font-family="Arial" font-size="12" text-anchor="middle">1×1, 256</text>
    <text x="330" y="205" font-family="Arial" font-size="12" text-anchor="middle">Output: 64×64×256</text>

    <!-- Stage 3 -->
    <rect x="430" y="120" width="160" height="100" fill="#fff" stroke="#52c41a" stroke-width="1" rx="3"/>
    <text x="510" y="140" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Stage 3 (×4)</text>
    <text x="510" y="160" font-family="Arial" font-size="12" text-anchor="middle">1×1, 128</text>
    <text x="510" y="175" font-family="Arial" font-size="12" text-anchor="middle">3×3, 128</text>
    <text x="510" y="190" font-family="Arial" font-size="12" text-anchor="middle">1×1, 512</text>
    <text x="510" y="205" font-family="Arial" font-size="12" text-anchor="middle">Output: 32×32×512</text>

    <!-- Stage 4 -->
    <rect x="610" y="120" width="160" height="100" fill="#fff" stroke="#52c41a" stroke-width="1" rx="3"/>
    <text x="690" y="140" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Stage 4 (×6)</text>
    <text x="690" y="160" font-family="Arial" font-size="12" text-anchor="middle">1×1, 256</text>
    <text x="690" y="175" font-family="Arial" font-size="12" text-anchor="middle">3×3, 256</text>
    <text x="690" y="190" font-family="Arial" font-size="12" text-anchor="middle">1×1, 1024</text>
    <text x="690" y="205" font-family="Arial" font-size="12" text-anchor="middle">Output: 16×16×1024</text>

    <!-- Stage 5 -->
    <rect x="790" y="120" width="160" height="100" fill="#fff" stroke="#52c41a" stroke-width="1" rx="3"/>
    <text x="870" y="140" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Stage 5 (×3)</text>
    <text x="870" y="160" font-family="Arial" font-size="12" text-anchor="middle">1×1, 512</text>
    <text x="870" y="175" font-family="Arial" font-size="12" text-anchor="middle">3×3, 512</text>
    <text x="870" y="190" font-family="Arial" font-size="12" text-anchor="middle">1×1, 2048</text>
    <text x="870" y="205" font-family="Arial" font-size="12" text-anchor="middle">Output: 8×8×2048</text>

    <!-- Residual Connections -->
    <path d="M 70,250 L 950,250" stroke="#52c41a" stroke-width="2" stroke-dasharray="5,5" fill="none"/>
    <text x="510" y="270" font-family="Arial" font-size="14" text-anchor="middle" fill="#52c41a">Identity Shortcut Connections (Residual Learning)</text>

    <!-- Attention Module -->
    <rect x="50" y="390" width="900" height="160" fill="#e6f7ff" stroke="#1890ff" stroke-width="2" rx="5"/>
    <text x="500" y="415" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold" fill="#1890ff">Feature Refinement</text>

    <!-- GeM Pooling -->
    <rect x="70" y="440" width="280" height="90" fill="#fff" stroke="#1890ff" stroke-width="1" rx="3"/>
    <text x="210" y="460" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">GeM Pooling</text>
    <text x="210" y="480" font-family="Arial" font-size="12" text-anchor="middle">f_gem = (1/|X| ∑ x_i^p)^(1/p)</text>
    <text x="210" y="495" font-family="Arial" font-size="12" text-anchor="middle">Learnable parameter p = 3</text>
    <text x="210" y="510" font-family="Arial" font-size="12" text-anchor="middle">Output: 2048-dim vector</text>

    <!-- BN + Dropout -->
    <rect x="370" y="440" width="280" height="90" fill="#fff" stroke="#1890ff" stroke-width="1" rx="3"/>
    <text x="510" y="460" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Feature Regularization</text>
    <text x="510" y="480" font-family="Arial" font-size="12" text-anchor="middle">Batch Normalization (γ, β)</text>
    <text x="510" y="495" font-family="Arial" font-size="12" text-anchor="middle">Dropout (p = 0.3)</text>
    <text x="510" y="510" font-family="Arial" font-size="12" text-anchor="middle">L2 Normalization</text>

    <!-- Linear Layer -->
    <rect x="670" y="440" width="280" height="90" fill="#fff" stroke="#1890ff" stroke-width="1" rx="3"/>
    <text x="810" y="460" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Embedding Layer</text>
    <text x="810" y="480" font-family="Arial" font-size="12" text-anchor="middle">Linear: 2048 → 2048</text>
    <text x="810" y="495" font-family="Arial" font-size="12" text-anchor="middle">No bias term</text>
    <text x="810" y="510" font-family="Arial" font-size="12" text-anchor="middle">Final feature representation</text>

    <!-- Training Objectives -->
    <rect x="50" y="570" width="900" height="210" fill="#fff2e8" stroke="#fa8c16" stroke-width="2" rx="5"/>
    <text x="500" y="595" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold" fill="#fa8c16">Training Objectives</text>

    <!-- Cross Entropy Loss -->
    <rect x="70" y="620" width="420" height="140" fill="#fff" stroke="#fa8c16" stroke-width="1" rx="3"/>
    <text x="280" y="640" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">ID Classification Loss</text>
    <text x="280" y="665" font-family="Arial" font-size="14" text-anchor="middle">Cross Entropy Loss</text>
    <text x="280" y="685" font-family="Arial" font-size="12" text-anchor="middle">L_ce = -∑y_i log(p_i)</text>
    <text x="280" y="705" font-family="Arial" font-size="12" text-anchor="middle">y_i: ground truth, p_i: predicted probability</text>
    <text x="280" y="725" font-family="Arial" font-size="12" text-anchor="middle">Softmax activation</text>
    <text x="280" y="745" font-family="Arial" font-size="12" text-anchor="middle">Weight: 1.0</text>

    <!-- Triplet Loss -->
    <rect x="510" y="620" width="420" height="140" fill="#fff" stroke="#fa8c16" stroke-width="1" rx="3"/>
    <text x="720" y="640" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Metric Learning Loss</text>
    <text x="720" y="665" font-family="Arial" font-size="14" text-anchor="middle">Triplet Loss with Hard Mining</text>
    <text x="720" y="685" font-family="Arial" font-size="12" text-anchor="middle">L_triplet = [d(a,p) - d(a,n) + margin]_+</text>
    <text x="720" y="705" font-family="Arial" font-size="12" text-anchor="middle">margin = 0.3, d(): Euclidean distance</text>
    <text x="720" y="725" font-family="Arial" font-size="12" text-anchor="middle">Online hard example mining</text>
    <text x="720" y="745" font-family="Arial" font-size="12" text-anchor="middle">Weight: 1.0</text>

</svg>
